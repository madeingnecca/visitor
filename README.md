Introduction
============

Visitor is a very simple link checker script. One file, no dependencies, and old school procedural style.

It is a "proof of concept" project, and many functionalities were written from scracth, like http transport and cookie management.

The purpose of Visitor is to help quality control when developing websites. A link checker will detect 404s and bad urls across pages of a website, hopefully before the final user will do.

Urls are collected by parsing the html response from the server: this means Visitor won't be very useful for websites in which a lot of content is generated by Javascript on the client.

Installation
============

Visitor is just a php script, so you can type:
<pre>php visitor.php</pre>
Alternatively Visitor is shipped with the <code>visitor</code> script, which just needs to be made executable to be run.
<pre>
chmod +x visitor
./visitor
</pre>

or, better:
<pre>
chmod +x visitor
ln -s "$(pwd)/visitor" /usr/bin/visitor
visitor
</pre>


Usage
=====

<pre>
visitor [--help -f -t -u --project --no-cookies --cookiejar] &lt;url&gt;
  --help: Print this message.
  -f: String to output whenever Visitor "visits" a new url.
    Available variables: %url, %code, %content_type, %parent, %headers:&lt;header_name_lowercase&gt;
  -t: Sets time limit, in seconds.
  -d: Sets depth limit.
  -u: Authentication credentials, &lt;user&gt;:&lt;pass&gt;
  --no-cookies: Tell Visitor not to store nor send cookies.
  --cookiejar: Path of the json file where all cookies found will be serialized to. This option will not work if "--no-cookies" flag is on.
  --project: Read url and options from &lt;CWD&gt;/visitor.json file.
</pre>

DTF setup
=========

Cron job to run every day at 11.30pm

<pre>30 23 * * * /usr/bin/visitor https://www.dtf.vic.gov.au > /home/centos/link-checker/logs/dtf-today.txt</pre>

Note: the above cron job has been setup on the AWS server (<code>13.210.214.84</code>)

When run, the script does the following:

1. Check for all links on DTF
2. Save all links with their status NOT match 200 to a text file <code>dtf-today.txt</code>
3. Do a diff check of the above file agaist the yesterday file, <code>dtif-yesterday.txt</code>
4. Email the diff file to <code>sdp.devs@dpc.vic.gov.au</code>

### Project file

The "project file" is just a way to pass options via json, instead of writing all the options every time using the CLI syntax.

We suggest storing the project file in the root directory of your web project, in order to let other team members run Visitor with ease, by just typing: <code>visitor --project</code>

Tests
=====

All features have been written as global functions to provide an easy way to test them.

Tests are written with phpunit and to run them just type:
<pre>phpunit</pre>
